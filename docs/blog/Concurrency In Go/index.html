<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Woshicai's Site Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Woshicai's Site Blog Atom Feed"><title data-react-helmet="true">Concurrency In Go | Woshicai&#x27;s Site</title><meta data-react-helmet="true" property="og:title" content="Concurrency In Go | Woshicai&#x27;s Site"><meta data-react-helmet="true" name="description" content="After reading the book Concurrency In Go, in order to better understand and remember what the book says, record key point about the book."><meta data-react-helmet="true" property="og:description" content="After reading the book Concurrency In Go, in order to better understand and remember what the book says, record key point about the book."><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/blog/Concurrency In Go"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/blog/Concurrency In Go"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/blog/Concurrency In Go" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/blog/Concurrency In Go" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.6676c5a3.css">
<link rel="preload" href="/assets/js/runtime~main.16bc0f48.js" as="script">
<link rel="preload" href="/assets/js/main.b887f79c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Woshicai&#x27;s Site</strong></a><a class="navbar__item navbar__link" href="/docs/intro">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/charles-woshicai/charles-woshicai.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Woshicai&#x27;s Site</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Tutorial</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/charles-woshicai/charles-woshicai.github.io" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/Concurrency In Go">Concurrency In Go</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/welcome">Welcome</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">Concurrency In Go</h1><div class="margin-vert--md"><time datetime="2021-05-05T16:16:32.369Z" class="blogPostDate_fNvV">May 6, 2021 · 3 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/charles-woshicai" alt="woshicai"></a><div class="avatar__intro"><h4 class="avatar__name"><a>woshicai</a></h4><small class="avatar__subtitle">woshicai</small></div></div></header><div class="markdown"><p>After reading the book <code>Concurrency In Go</code>, in order to better understand and remember what the book says, record key point about the book.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="charter-1-an-introduction-to-concurrency"></a>Charter 1. An introduction to Concurrency<a class="hash-link" href="#charter-1-an-introduction-to-concurrency" title="Direct link to heading">#</a></h2><p>第一节主要介绍了Concurrency的定义以及历史.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="moores-law-web-scale-and-the-mess-were-in"></a>Moore&#x27;s Law, Web Scale, and the Mess We&#x27;re In<a class="hash-link" href="#moores-law-web-scale-and-the-mess-were-in" title="Direct link to heading">#</a></h3><p>介绍了摩尔定律以及Amdahl’s Law
<a href="https://zh.wikipedia.org/wiki/%E6%91%A9%E5%B0%94%E5%AE%9A%E5%BE%8B" target="_blank" rel="noopener noreferrer">摩尔定律</a>
<a href="https://zh.wikipedia.org/wiki/%E9%98%BF%E5%A7%86%E8%BE%BE%E5%B0%94%E5%AE%9A%E5%BE%8B" target="_blank" rel="noopener noreferrer">Amdahl’s Law</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="why-is-concurrency-hard"></a>Why is Concurrency Hard<a class="hash-link" href="#why-is-concurrency-hard" title="Direct link to heading">#</a></h3><p>介绍几种引入concurrency带来的通用问题</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="race-condition"></a>Race Condition<a class="hash-link" href="#race-condition" title="Direct link to heading">#</a></h4><p>“A race condition occurs when two or more operations must execute in the correct order, but the program has not been written so that this order is guaranteed to be maintained”</p><p>简单来说就是一致性问题</p><blockquote><p>一个简单的反面例子</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><div tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> data </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">go</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain">     data</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> data </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain">     fmt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;the value is %v.\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="atomicity"></a>Atomicity<a class="hash-link" href="#atomicity" title="Direct link to heading">#</a></h4><p>“When something is considered atomic, or to have the property of atomicity, this means that within the context that it is operating, it is indivisible, or uninterruptible.”</p><p>原子性 不可打断的最小操作</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="memory-access-synchronization"></a>Memory Access Synchronization<a class="hash-link" href="#memory-access-synchronization" title="Direct link to heading">#</a></h4><p><a href="https://golang.org/ref/mem" target="_blank" rel="noopener noreferrer">官方参考资料</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deadlocks-livelocks-and-starvation"></a>Deadlocks, Livelocks, and Starvation<a class="hash-link" href="#deadlocks-livelocks-and-starvation" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deadlock"></a>Deadlock<a class="hash-link" href="#deadlock" title="Direct link to heading">#</a></h5><p>死锁</p><p>常见的几种场景</p><ul><li>Mutual Exclusion<ul><li>A concurrent process holds exclusive rights to a resource at any one time</li></ul></li><li>Wait for condition<ul><li>A concurrent process must simultaneously hold a resource and be waiting for an additional resource.</li></ul></li><li>No Preemption<ul><li>A resource held by a concurrent process can only be released by that process, so it fulfills this condition.</li></ul></li><li>Circular Wait<ul><li>A concurrent process (P1) must be waiting on a chain of other concurrent processes (P2), which are in turn waiting on it (P1), so it fulfills this final condition too.</li></ul></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="livelock"></a>Livelock<a class="hash-link" href="#livelock" title="Direct link to heading">#</a></h5><p>Livelocks are programs that are actively performing concurrent operations, but these operations do nothing to move the state of the program forward.</p><p>程序在跑 但是程序的状态一直停留在原地</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="starvation"></a>Starvation<a class="hash-link" href="#starvation" title="Direct link to heading">#</a></h5><p>Starvation is any situation where a concurrent process cannot get all the resources it needs to perform work.</p><p>过多的程序在竞争资源 导致资源都耗费在调度上了 结果大家都分不到资源</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="determining-concurrency-safety"></a>Determining Concurrency Safety<a class="hash-link" href="#determining-concurrency-safety" title="Direct link to heading">#</a></h5><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="simplicity-in-the-face-of-complexity"></a>Simplicity in the Face of Complexity<a class="hash-link" href="#simplicity-in-the-face-of-complexity" title="Direct link to heading">#</a></h4><p>介绍了和其他变成语言相比 go在concurrency这块做了哪些工作:</p><ul><li>内存管理 即 gc</li><li>goroutine调度 抽象的goroutine调度到操作系统的thread</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="charter-2-modeling-your-code-communicating-sequential-processes"></a>Charter 2. Modeling Your Code: Communicating Sequential Processes<a class="hash-link" href="#charter-2-modeling-your-code-communicating-sequential-processes" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-difference-between-concurrency-and-parallelism"></a>The Difference Between Concurrency and Parallelism<a class="hash-link" href="#the-difference-between-concurrency-and-parallelism" title="Direct link to heading">#</a></h3><p>The fact that concurrency is different from parallelism is often overlooked or misunderstood. In conversations between many developers, the two terms are often used interchangeably to mean “something that runs at the same time as something else.” Sometimes using the word “parallel” in this context is correct, but usually if the developers are discussing code, they really ought to be using the word “concurrent.
并发和并行的区别</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-is-csp"></a>What Is CSP?<a class="hash-link" href="#what-is-csp" title="Direct link to heading">#</a></h3><p>CSP: Communicating Sequential Processes
<a href="https://dl.acm.org/doi/10.1145/359576.359585" target="_blank" rel="noopener noreferrer">CSP Paper</a></p><p>常规的并发安全思路是通过对内存的访问顺序做文章来保证内存的一致性, CSP提出了一种新的思路, 并发程序之间通过显式的输入输出来控制数据的access.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-this-helps-you"></a>How This Helps You<a class="hash-link" href="#how-this-helps-you" title="Direct link to heading">#</a></h4><p>go采纳了CSP的思路来实现并发, 诞生了goroutine和channel.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="gos-philosophy-on-concurrency"></a>Go’s Philosophy on Concurrency<a class="hash-link" href="#gos-philosophy-on-concurrency" title="Direct link to heading">#</a></h4><p><a href="https://golang.org/ref/mem" target="_blank" rel="noopener noreferrer">官方参考资料</a></p><blockquote><p>关于选择channel还是sync包的参考</p></blockquote><hr><p><img src="evernotecid://C89FDA3E-A873-421C-BFAE-498A116E39F9/appyinxiangcom/27330777/ENResource/p103" alt="d04f6a989475155abb25e5407ce337af.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="chapter-3-gos-concurrency-building-blocks"></a>Chapter 3. Go’s Concurrency Building Blocks<a class="hash-link" href="#chapter-3-gos-concurrency-building-blocks" title="Direct link to heading">#</a></h2></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/go">go</a></div></footer></article><div><a href="https://github.com/charles-woshicai/charles-woshicai.github.io/edit/master/docs/blog/blog/concurrency-in-go.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/welcome"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Welcome »</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#charter-1-an-introduction-to-concurrency" class="table-of-contents__link">Charter 1. An introduction to Concurrency</a><ul><li><a href="#moores-law-web-scale-and-the-mess-were-in" class="table-of-contents__link">Moore&#39;s Law, Web Scale, and the Mess We&#39;re In</a></li><li><a href="#why-is-concurrency-hard" class="table-of-contents__link">Why is Concurrency Hard</a></li></ul></li><li><a href="#charter-2-modeling-your-code-communicating-sequential-processes" class="table-of-contents__link">Charter 2. Modeling Your Code: Communicating Sequential Processes</a><ul><li><a href="#the-difference-between-concurrency-and-parallelism" class="table-of-contents__link">The Difference Between Concurrency and Parallelism</a></li><li><a href="#what-is-csp" class="table-of-contents__link">What Is CSP?</a></li></ul></li><li><a href="#chapter-3-gos-concurrency-building-blocks" class="table-of-contents__link">Chapter 3. Go’s Concurrency Building Blocks</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/charles-woshicai/charles-woshicai.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.16bc0f48.js"></script>
<script src="/assets/js/main.b887f79c.js"></script>
</body>
</html>